---
phase: 03-home-history
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/hooks/use-game-history.ts
  - src/components/home/home-screen.tsx
  - src/components/home/game-history-list.tsx
  - src/components/home/game-history-item.tsx
  - src/components/home/empty-history.tsx
autonomous: true

must_haves:
  truths:
    - "Home screen shows New Game and Continue Game options"
    - "Past games are listed with player names and scores"
    - "Winner is highlighted in each game card"
    - "Empty state shown when no game history"
  artifacts:
    - path: "src/hooks/use-game-history.ts"
      provides: "Hook for fetching game history from Firestore"
      exports: ["useGameHistory"]
    - path: "src/components/home/home-screen.tsx"
      provides: "Main home screen with New Game, Continue, and history"
      min_lines: 50
    - path: "src/components/home/game-history-list.tsx"
      provides: "List component for game history items"
      min_lines: 20
    - path: "src/components/home/game-history-item.tsx"
      provides: "Card component for single game in history"
      min_lines: 40
    - path: "src/components/home/empty-history.tsx"
      provides: "Empty state component"
      min_lines: 15
  key_links:
    - from: "src/hooks/use-game-history.ts"
      to: "src/lib/firestore-game.ts"
      via: "getGameHistory import"
      pattern: "getGameHistory"
    - from: "src/components/home/home-screen.tsx"
      to: "src/hooks/use-game-history.ts"
      via: "useGameHistory hook"
      pattern: "useGameHistory"
---

<objective>
Build the Home Screen UI components and game history hook.

Purpose: Create the visual foundation for the home screen that shows game history, active game continuation, and new game option. This plan creates all home components without wiring them into page.tsx.

Output: Complete home screen component hierarchy ready for integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-home-history/03-RESEARCH.md
@.planning/phases/03-home-history/03-01-SUMMARY.md

# Reference for styling patterns
@src/components/game/game-setup.tsx
@src/components/game/score-history-dialog.tsx
@src/components/icons.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useGameHistory hook</name>
  <files>src/hooks/use-game-history.ts</files>
  <action>
Create a new hook file at src/hooks/use-game-history.ts.

The hook should:
- Accept userId (string | null) and isFirebaseReady (boolean) parameters
- Return { games: StoredGameState[], isLoading: boolean, error: Error | null, refetch: () => void }
- Fetch game history using getGameHistory from @/lib/firestore-game
- Handle loading state (start true, set false after fetch completes or errors)
- Include refetch function to manually re-fetch history (useful after returning to home)
- Use cleanup pattern to prevent state updates after unmount

```typescript
'use client';

import { useState, useEffect, useCallback } from 'react';
import { getGameHistory } from '@/lib/firestore-game';
import type { StoredGameState } from '@/lib/types';

interface UseGameHistoryResult {
  games: StoredGameState[];
  isLoading: boolean;
  error: Error | null;
  refetch: () => void;
}

export function useGameHistory(
  userId: string | null,
  isFirebaseReady: boolean
): UseGameHistoryResult {
  const [games, setGames] = useState<StoredGameState[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<Error | null>(null);
  const [fetchTrigger, setFetchTrigger] = useState(0);

  const refetch = useCallback(() => {
    setFetchTrigger(prev => prev + 1);
  }, []);

  useEffect(() => {
    if (!userId || !isFirebaseReady) {
      setIsLoading(false);
      return;
    }

    let cancelled = false;
    setIsLoading(true);
    setError(null);

    async function fetchHistory() {
      try {
        const history = await getGameHistory(userId!);
        if (!cancelled) {
          setGames(history);
          setIsLoading(false);
        }
      } catch (err) {
        if (!cancelled) {
          setError(err instanceof Error ? err : new Error('Failed to load history'));
          setIsLoading(false);
        }
      }
    }

    fetchHistory();
    return () => { cancelled = true; };
  }, [userId, isFirebaseReady, fetchTrigger]);

  return { games, isLoading, error, refetch };
}
```
  </action>
  <verify>Run `npm run typecheck` - hook should compile without errors.</verify>
  <done>useGameHistory hook created with loading, error, and refetch support.</done>
</task>

<task type="auto">
  <name>Task 2: Create home screen components</name>
  <files>
    src/components/home/home-screen.tsx
    src/components/home/game-history-list.tsx
    src/components/home/game-history-item.tsx
    src/components/home/empty-history.tsx
  </files>
  <action>
Create the src/components/home/ directory and four component files. Follow the existing design patterns from game-setup.tsx and score-history-dialog.tsx.

**1. empty-history.tsx** - Simple empty state:
```typescript
'use client';

import { QwirkleShape } from '@/components/icons';

interface EmptyHistoryProps {
  onNewGame: () => void;
}

export function EmptyHistory({ onNewGame }: EmptyHistoryProps) {
  return (
    <div className="text-center py-12 space-y-4">
      <QwirkleShape shape="starburst" className="h-16 w-16 text-gray-300 mx-auto" />
      <div>
        <h3 className="font-headline text-lg font-bold text-gray-700">No games yet</h3>
        <p className="text-gray-500 text-sm">Start your first game and it will appear here</p>
      </div>
    </div>
  );
}
```

**2. game-history-item.tsx** - Card for single game:
```typescript
'use client';

import { formatDistanceToNow } from 'date-fns';
import type { StoredGameState } from '@/lib/types';
import { QwirkleShape } from '@/components/icons';
import { Trophy } from 'lucide-react';
import { cn } from '@/lib/utils';

const PLAYER_COLORS = ['#DC2626', '#2563EB', '#16A34A', '#CA8A04', '#9333EA', '#EA580C'];

interface GameHistoryItemProps {
  game: StoredGameState;
  onSelect: (game: StoredGameState) => void;
}

export function GameHistoryItem({ game, onSelect }: GameHistoryItemProps) {
  // Find winner(s) - handle ties
  const maxScore = Math.max(...game.players.map(p => p.totalScore));
  const winners = game.players.filter(p => p.totalScore === maxScore);
  const isTie = winners.length > 1;

  // Format relative time on client only to avoid hydration mismatch
  const relativeTime = game.completedAt
    ? formatDistanceToNow(new Date(game.completedAt), { addSuffix: true })
    : 'Unknown';

  return (
    <button
      onClick={() => onSelect(game)}
      className="w-full text-left bg-white p-4 rounded-2xl shadow-sm border border-gray-100 hover:shadow-md hover:border-gray-200 transition-all active:scale-[0.98]"
    >
      <div className="flex items-start justify-between mb-3">
        <span className="text-xs text-gray-400 font-medium">{relativeTime}</span>
        {isTie && (
          <span className="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full font-bold">
            TIE
          </span>
        )}
      </div>

      <div className="flex flex-wrap gap-2">
        {game.players.map((player, idx) => {
          const isWinner = player.totalScore === maxScore && maxScore > 0;
          const color = PLAYER_COLORS[idx % PLAYER_COLORS.length];

          return (
            <div
              key={player.id}
              className={cn(
                'flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-bold',
                isWinner ? 'bg-yellow-50 ring-2 ring-yellow-300' : 'bg-gray-50'
              )}
            >
              {isWinner && <Trophy className="h-3 w-3 text-yellow-600" />}
              <span className="text-gray-700">{player.name}</span>
              <span style={{ color }} className="font-black">{player.totalScore}</span>
            </div>
          );
        })}
      </div>
    </button>
  );
}
```

**3. game-history-list.tsx** - List wrapper:
```typescript
'use client';

import type { StoredGameState } from '@/lib/types';
import { GameHistoryItem } from './game-history-item';
import { EmptyHistory } from './empty-history';
import { Loader2 } from 'lucide-react';

interface GameHistoryListProps {
  games: StoredGameState[];
  isLoading: boolean;
  error: Error | null;
  onSelectGame: (game: StoredGameState) => void;
  onNewGame: () => void;
}

export function GameHistoryList({
  games,
  isLoading,
  error,
  onSelectGame,
  onNewGame,
}: GameHistoryListProps) {
  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="h-8 w-8 text-orange-500 animate-spin" />
      </div>
    );
  }

  if (error) {
    return (
      <div className="text-center py-12 text-red-500">
        <p className="font-medium">Failed to load history</p>
        <p className="text-sm text-gray-500">{error.message}</p>
      </div>
    );
  }

  if (games.length === 0) {
    return <EmptyHistory onNewGame={onNewGame} />;
  }

  return (
    <div className="space-y-3">
      {games.map(game => (
        <GameHistoryItem
          key={game.id}
          game={game}
          onSelect={onSelectGame}
        />
      ))}
    </div>
  );
}
```

**4. home-screen.tsx** - Main home component:
```typescript
'use client';

import { Button } from '@/components/ui/button';
import { QwirkleShape } from '@/components/icons';
import { GameHistoryList } from './game-history-list';
import type { StoredGameState, GameState } from '@/lib/types';
import { Play, History } from 'lucide-react';

interface HomeScreenProps {
  hasActiveGame: boolean;
  onNewGame: () => void;
  onContinueGame: () => void;
  games: StoredGameState[];
  isLoadingHistory: boolean;
  historyError: Error | null;
  onSelectGame: (game: StoredGameState) => void;
}

export function HomeScreen({
  hasActiveGame,
  onNewGame,
  onContinueGame,
  games,
  isLoadingHistory,
  historyError,
  onSelectGame,
}: HomeScreenProps) {
  return (
    <div className="flex-1 flex flex-col p-6 space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-700">
      {/* Action Buttons */}
      <div className="space-y-3">
        {hasActiveGame && (
          <Button
            onClick={onContinueGame}
            className="w-full h-16 rounded-2xl bg-primary hover:bg-orange-600 text-white border-b-4 border-orange-700 active:border-b-0 active:translate-y-1 font-black text-xl shadow-lg transition-all flex items-center justify-center gap-3"
          >
            <Play className="h-6 w-6" />
            CONTINUE GAME
          </Button>
        )}

        <Button
          onClick={onNewGame}
          variant={hasActiveGame ? 'outline' : 'default'}
          className={
            hasActiveGame
              ? 'w-full h-14 rounded-xl border-2 border-gray-200 text-gray-700 font-bold hover:bg-gray-50 transition-all flex items-center justify-center gap-2'
              : 'w-full h-16 rounded-2xl bg-primary hover:bg-orange-600 text-white border-b-4 border-orange-700 active:border-b-0 active:translate-y-1 font-black text-xl shadow-lg transition-all flex items-center justify-center gap-3'
          }
        >
          <QwirkleShape shape="starburst" className="h-5 w-5" />
          {hasActiveGame ? 'Start New Game' : 'START NEW GAME'}
        </Button>
      </div>

      {/* Game History Section */}
      <div className="flex-1 space-y-4">
        <div className="flex items-center gap-2">
          <History className="h-5 w-5 text-gray-400" />
          <h2 className="font-headline font-bold text-gray-600 text-sm uppercase tracking-wider">
            Recent Games
          </h2>
        </div>

        <GameHistoryList
          games={games}
          isLoading={isLoadingHistory}
          error={historyError}
          onSelectGame={onSelectGame}
          onNewGame={onNewGame}
        />
      </div>
    </div>
  );
}
```

Ensure all components follow the 'use client' directive and use existing UI patterns (rounded corners, shadows, colors).
  </action>
  <verify>Run `npm run typecheck` - all components should compile. Verify files exist in src/components/home/.</verify>
  <done>Home screen component hierarchy created: HomeScreen, GameHistoryList, GameHistoryItem, EmptyHistory. All follow existing design patterns.</done>
</task>

</tasks>

<verification>
- `npm run typecheck` passes
- src/hooks/use-game-history.ts exists and exports useGameHistory
- src/components/home/ directory contains all four components
- All components use 'use client' directive
- Design patterns match existing components (rounded-2xl, shadow-sm, font-headline, etc.)
</verification>

<success_criteria>
- useGameHistory hook fetches game history with loading/error states
- HomeScreen shows Continue Game (if active) and New Game buttons
- GameHistoryList renders games or empty state
- GameHistoryItem shows players, scores, winner, and relative time
- All components ready for integration in plan 03
</success_criteria>

<output>
After completion, create `.planning/phases/03-home-history/03-02-SUMMARY.md`
</output>
